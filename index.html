<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day Planner</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Orbitron|Spartan|Taviraj|Viga&display=swap" rel="stylesheet">
    <script src="lib/moment/moment.min.js"></script>
</head>

<body>

    <header class="backgroundBlend text-center">
        <h1>Day Planner</h1>
        <p>Use this calender to help allocate time towards to your daily plans!</p>
        <div class="row">

            <div class="col-4">
                <button class="alexBtn btn btn-light float-right" id="prevBtn">Past Day</button>
            </div>
            <div class="col-4 textCenter">
                <h2 id="currentDay"></h2>
            </div>
            <div class="col-4">
                <button class="alexBtn btn btn-light float-left" id="nextBtn">Next Day</button>
            </div>

        </div>
    </header>

    <div class="container timeRows">



    </div>
</body>


<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<script src="script.js"></script>

<script>
    const currentDayEl = $("#currentDay")
    const timeRowsDiv = $(".timeRows")

    function makeTimerows() {
        // Sets day in header to current day
        currentDayEl.text(moment().format('MMMM Do YYYY'))



        // Sets planner up as user had it last 

        var storedObj = localStorage.getItem("userData")
        storedObj = JSON.parse(storedObj)

        // If there isnt already a storage object this creates one
        if (!storedObj) {
            storedObj = {}
        }

        for (i = 0; i < 24; i++) {
            let individualRow = document.createElement("div");
            individualRow.classList.add("row");
            individualRow.classList.add("alxStyling");

            let rowHour = moment().hour(i)

            // Making the time row subsections

            // Displays the Hour and AM/PM on the side
            let hourSection = document.createElement("div");
            hourSection.classList.add("col-1");
            hourSection.classList.add("rowTime");
            hourSection.innerText = rowHour.format("hA")
            let descriptionClass = rowHour.isBefore(moment(), 'hour') ?
                "past" :
                rowHour.isSame(moment(), 'hour') ?
                "present" :
                "future";
            hourSection.classList.add(descriptionClass);

            // Displays the text the user has writen and displays it in the middle
            let entrySection = document.createElement("div")
            entrySection.classList.add("col-10");
            entrySection.classList.add("rowEntry");
            entrySection.setAttribute("data-hour", i);
            entrySection.contentEditable = true;
            // Reads if the correlated row is in the past present or future and assigns a class based on the result

            // Makes a save button and an event listner that runs a save function

            let saveSection = document.createElement("button");
            saveSection.classList.add("col-1");
            saveSection.classList.add("rowSave");
            saveSection.textContent = "Save"
            saveSection.setAttribute("data-hour", i);
            saveSection.addEventListener("click", (event) => {
                console.log("Saved")
                let userSave = localStorage.getItem("userData")
                userSave = JSON.parse(userSave)

                let dataPointer = $(`div[data-hour="${event.currentTarget.dataset.hour}"]`).text

                if (!userSave) {
                    userSave = {}
                }

                if (!userSave[selectedDay.format("YYYY-MM-DD")]) {
                    userSave[selectedDay.format("YYYY-MM-DD")] = [];
                }
            })

            // merging subsection cols to make a row
            individualRow.appendChild(hourSection)
            individualRow.appendChild(entrySection)
            individualRow.appendChild(saveSection)

            timeRowsDiv.append(individualRow);

        }

    }
    let selectedDay = moment()
    let currentDay = makeTimerows(selectedDay)
    timeRowsDiv.append(selectedDay)
</script>

</html>

<!-- <div class="row">
            <div class="col-2">
                <p>7AM</p>
            </div>
            <div class="col-10">
                <input type="text">
            </div>
        </div> -->